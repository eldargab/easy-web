#!/usr/bin/env bash

bench() {
  wrk -t4 -c20 -r10000 http://127.0.0.1:8000$1 \
    | grep "Requests/sec" \
    | cut -d ':' -f 2 \
    | xargs echo "$2:"
}

node_hello_bench() {
  bench / "Node.js Hello World"
}

app_bench() {
  bench / "Hello World"
  bench /subapp/hello "Subapp"
}

with() {
  node ./bench/$1 &
  local pid=$!
  sleep .5
  $2
  kill $pid
  sleep .5
}

with node-hello.js node_hello_bench
with app.js app_bench
