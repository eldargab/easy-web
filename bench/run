#!/usr/bin/env bash

bench() {
  wrk -t4 -c30 -d5s http://127.0.0.1:8000$1 \
    | grep "Requests/sec" \
    | cut -d ':' -f 2 \
    | xargs echo "$2:"
}

with() {
  node ./bench/$1 &
  local pid=$!
  sleep .2
  $2
  kill $pid
  sleep .2
}

echo
echo EasyWeb
echo

easy_web() {
  bench / "Hello world"
  bench /just-set-immediate "Just setImmediate()"
  bench /one-async-task "One async task"
  bench /async-computation "Async computation"
  bench /sync-computation "Sync computation"
  bench /subapp/hello "Subapp"
}

with easy-web.js easy_web

echo
echo Other Hello world servers
echo

with node.js "bench / Node.js"
with pure-http.js "bench / Http"
with express.js "bench / Express"

echo

